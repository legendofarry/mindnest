[build]
  base = "."
  publish = "build/web"
  command = """
    git clone https://github.com/flutter/flutter.git --depth 1 -b stable $HOME/flutter
    export PATH="$HOME/flutter/bin:$PATH"
    flutter config --enable-web
    flutter pub get
    if [ -z "$LIVEKIT_URL" ] || [ -z "$LIVEKIT_API_KEY" ] || [ -z "$LIVEKIT_API_SECRET" ]; then
      echo "Missing one or more required Netlify env vars: LIVEKIT_URL, LIVEKIT_API_KEY, LIVEKIT_API_SECRET."
      exit 1
    fi
    flutter build web --release \
      --dart-define=LIVEKIT_URL=$LIVEKIT_URL \
      --dart-define=LIVEKIT_API_KEY=$LIVEKIT_API_KEY \
      --dart-define=LIVEKIT_API_SECRET=$LIVEKIT_API_SECRET \
      --dart-define=PUSH_DISPATCH_ENDPOINT=$PUSH_DISPATCH_ENDPOINT \
      --dart-define=FIREBASE_WEB_VAPID_KEY=$FIREBASE_WEB_VAPID_KEY
  """

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
