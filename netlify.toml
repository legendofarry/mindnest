[build]
  base = "."
  publish = "build/web"
  command = """
    git clone https://github.com/flutter/flutter.git --depth 1 -b stable $HOME/flutter
    export PATH="$HOME/flutter/bin:$PATH"
    flutter config --enable-web
    npm --prefix netlify/functions install
    flutter pub get
    TOKEN_ENDPOINT="${LIVEKIT_TOKEN_ENDPOINT:-/livekit/token}"
    flutter build web --release --dart-define=LIVEKIT_TOKEN_ENDPOINT=$TOKEN_ENDPOINT
  """

[functions]
  directory = "netlify/functions"

[[redirects]]
  from = "/livekit/token"
  to = "/.netlify/functions/livekit-token"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
